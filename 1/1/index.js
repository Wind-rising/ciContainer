(()=>{"use strict";var e={541:(e,t,n)=>{n.d(t,{v:()=>s});var i=n(482);console.log(111223);let s=Object.assign({},"dev"==i.V.dev?{getSdkSign:"(function() {  var s = new URLSearchParams(location.search);s = s.get('pubPath')+'/index.js?timestamp='+(+new Date()); var v = document.createElement('script');v.src = s;v.type = 'module';v.onload = window.sdkLoadCallback;v.onerror = window.sdkLoadErrorBack; var b = document.getElementsByTagName(\"script\")[0];b.parentNode.insertBefore(v, b);})();",sdkType:"script"}:"dev"==i.V.uat?{getSdkSign:"http://pubh5sdk-uat.iwgame.com/index.js",sdkType:""}:{getSdkSign:"http://pubh5sdk-master.iwgame.com/index.js",sdkType:""})},206:(e,t,n)=>{n.d(t,{F:()=>i});class i{constructor(){this.sdkScript="(function() {  var s = new URLSearchParams(location.search);s = s.get('pubPath')+'/index.js?timestamp='+(+new Date()); var v = document.createElement('script');v.src = s;v.type = 'module';v.onload = window.sdkLoadCallback;v.onerror = window.sdkLoadErrorBack; var b = document.getElementsByTagName(\"script\")[0];b.parentNode.insertBefore(v, b);})();",this.sdkType="script",this.publisherFuncList={init:window.PUBLASDK.init,login:window.PUBLASDK.login,pay:window.PUBLASDK.pay,logout:window.PUBLASDK.logout,onEventLog:window.PUBLASDK.onEventLog}}init(e){const{game_version:t,appkey:n}=e;return new Promise(((e,n)=>{this.publisherFuncList.init({game_version:t,callback:t=>{200==t.code?e(!0):n(t)}})}))}login(){return new Promise(((e,t)=>{this.publisherFuncList.login({callback:t=>{200==t.code&&e({code:200,data:{pubsdkToken:t.data.token}})}})}))}pay(e){const{order_amount:t,order_moneytype:n="CNY",zone_id:i,server_id:s,server_name:r,gameVersion:a,role_id:o,role_name:d,role_sex:c,role_prof:l,role_level:u,role_vip_level:p,role_reborn_level:h,role_combat:g,map_id:m,money_balance:_,bmoney_balance:f,gold_balance:v,online_time:b,user_ip:k,extension:w}=e;return new Promise(((e,I)=>{this.publisherFuncList.pay({order_amount:t,order_moneytype:n,zone_id:i,server_id:s,server_name:r,gameVersion:a,role_id:o,role_name:d,role_sex:c,role_prof:l,role_level:u,role_vip_level:p,role_reborn_level:h,role_combat:g,map_id:m,money_balance:_,bmoney_balance:f,gold_balance:v,online_time:b,user_ip:k,extension:w,callback:t=>{e(!0)}})}))}logout(){this.publisherFuncList.logout({callback:()=>{}}),window.location.reload()}report(e,t){this.publisherFuncList.onEventLog({eventCode:e,eventData:t})}}},482:(e,t,n)=>{var i;n.d(t,{V:()=>i}),function(e){e.dev="dev",e.uat="uat",e.master="master"}(i||(i={}))},147:e=>{e.exports=JSON.parse('{"name":"cph5sdk","version":"4.0.5","scripts":{"webpack:help":"webpack --help","server":"http-server dist/","server:cors":"http-server dist/ --cors","watch":"webpack --env envPath=./.env watch=true","dev":"npm run watch & npm run server","dev:cors":"npm run dev & npm run server:cors","build:dev":"webpack --env envPath=./.env","build":"webpack --env envPath=./.env.prod","build:zip":"sh ./build/buildZip.sh"},"sideEffects":["./src/devices/h5.js","./src/devices/android.js","./src/devices/ios.js","./src/publisher/lvantest/index.js"],"type":"commonjs","devDependencies":{"@babel/core":"^7.19.1","@babel/plugin-transform-runtime":"^7.19.1","@babel/polyfill":"^7.12.1","@babel/preset-env":"^7.19.1","babel-loader":"^8.2.5","cross-env":"^7.0.3","dotenv-webpack":"^8.0.1","filehound":"^1.17.6","ts-loader":"^9.4.1","tslib":"^2.4.0","ttypescript":"^1.5.13","typescript":"^4.8.3","typescript-transform-paths":"^3.3.1","webpack":"^5.74.0","webpack-cli":"^4.10.0"},"dependencies":{"base-h5sdk":"^1.0.3","clean-webpack-plugin":"^4.0.0","dotenv":"^16.0.2","module-alias":"^2.2.2","ts-md5":"^1.2.11","tsc-alias":"^1.7.0"}}')},685:e=>{e.exports=JSON.parse('{"cpglog":{"heartbeat":"game_id,pub_id,tunnel_id,platform,app_version,device_id,cpsdk_version,cpsdk_account_id,zone_id","level_up":"game_id,pub_id,tunnel_id,platform,app_version,device_id,cpsdk_version,cpsdk_account_id,zone_id","active":"game_id,pub_id,tunnel_id,platform,app_version,device_id,cpsdk_version","create_role":"game_id,pub_id,tunnel_id,platform,app_version,device_id,cpsdk_version,cpsdk_account_id,zone_id","login":"game_id,pub_id,tunnel_id,platform,app_version,device_id,cpsdk_version,cpsdk_account_id","pay_order_client":"game_id,pub_id,tunnel_id,platform,app_version,device_id,cpsdk_version,cpsdk_account_id,zone_id","version":"1.0","vip_level_up":"game_id,pub_id,tunnel_id,platform,app_version,device_id,cpsdk_version,cpsdk_account_id,zone_id","pay_success":"game_id,pub_id,tunnel_id,platform,app_version,device_id,cpsdk_version,cpsdk_account_id,pubsdk_account_id,zone_id","pay_order":"game_id,pub_id,tunnel_id,platform,app_version,device_id,cpsdk_version,cpsdk_account_id,zone_id","reg":"game_id,pub_id,tunnel_id,platform,app_version,device_id,cpsdk_version,cpsdk_account_id","role_login":"game_id,pub_id,tunnel_id,platform,app_version,device_id,cpsdk_version,cpsdk_account_id,zone_id","select_server":"game_id,pub_id,tunnel_id,platform,app_version,device_id,cpsdk_version,cpsdk_account_id,zone_id","role_logout":"game_id,pub_id,tunnel_id,platform,app_version,device_id,cpsdk_version,cpsdk_account_id,zone_id"}}')}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=n(482);function t(){var e=performance.timing?performance.timing.navigationStart:performance.timeOrigin;return 1e3*(performance.now()+e)}function i(e,t){return(e+"").length>=t?e+"":new Array(t+1-(e+"").length).join("0")+e}function s(){var e=navigator.userAgent,t="";if(e.indexOf("Mac OS X")>-1)t="IOS "+(e.match(/OS [\d._]*/gi)+"").replace(/[^0-9|_.]/gi,"").replace(/_/gi,".");else if(e.indexOf("Android")>-1||e.indexOf("Linux")>-1)t="Android "+e.substr(e.indexOf("Android")+8,e.indexOf(";",e.indexOf("Android"))-e.indexOf("Android")-8);else if(e.indexOf("BB10")>-1)t="blackberry "+e.substr(e.indexOf("BB10")+5,e.indexOf(";",e.indexOf("BB10"))-e.indexOf("BB10")-5);else if(e.indexOf("IEMobile")>-1)t="winphone "+e.substr(e.indexOf("IEMobile")+9,e.indexOf(";",e.indexOf("IEMobile"))-e.indexOf("IEMobile")-9);else{var n=navigator.userAgent.toLowerCase();t=n.indexOf("windows nt 5.0")>-1?"Windows 2000":n.indexOf("windows nt 5.1")>-1||n.indexOf("windows nt 5.2")>-1?"Windows XP":n.indexOf("windows nt 6.0")>-1?"Windows Vista":n.indexOf("windows nt 6.1")>-1||n.indexOf("windows 7")>-1?"Windows 7":n.indexOf("windows nt 6.2")>-1||n.indexOf("windows 8")>-1?"Windows 8":n.indexOf("windows nt 6.3")>-1?"Windows 8.1":n.indexOf("windows nt 6.2")>-1||n.indexOf("windows nt 10.0")>-1?"Windows 10":"Unknown"}return t.toLocaleLowerCase()}function r(){let e=localStorage.getItem("cp_unFirstActive")?0:1;return localStorage.setItem("cp_unFirstActive","1"),e+""}class a{constructor(){this.urlParams=this.analysis()}static getInstance(){return this.instance}analysis(){return(e=>{let t={};return e.split("&").map((e=>{let n=e.split("=");t[n[0]]=n[1]})),t})(location.search.slice(1,location.search.length))}get(e){return this.urlParams[e]}getAll(){return this.urlParams}getIsAndroid(){return Boolean(a.getInstance().get("android"))}getIsIos(){return Boolean(a.getInstance().get("ios"))}getIsApp(){return Boolean(a.getInstance().get("isApp"))}getPubisherId(){return a.getInstance().get("pubId")}getPubisherCode(){return a.getInstance().get("pubCode")}getGameId(){return a.getInstance().get("gameId")}getZoneId(){return a.getInstance().get("zoneId")}getTunnelId(){return a.getInstance().get("tunnelId")}}a.instance=new a;class o{static common(...t){"dev"!=e.V.master&&console.log("[cpsdk][debugger log]:",...t)}static commonS(...t){("dev"!=e.V.master||"debug"==a.getInstance().get("logDebug"))&&console.log("[cpsdk][info]:",...t)}static error(...t){"dev"!=e.V.master&&console.error("[cpsdk][error]:",...t)}static warn(...t){"dev"!=e.V.master&&console.warn("[cpsdk][warnning]:",...t)}static timeStart(n){if("dev"!=e.V.master)return this.logTimeState.hasOwnProperty(n)&&this.error(`logName ${n} is exist`),this.logTimeState[n]=t(),console.log(`[cpsdk][timer]:start ${n}`),n}static timeEnd(n){if("dev"!=e.V.master){this.logTimeState.hasOwnProperty(n)||this.error(`logName ${n} is not exist`);const e=t()-this.logTimeState[n];return console.log(`[cpsdk][timer]:end ${n} --${e}μs`),e}}}o.logTimeState={};class d{static requestGet(e){const{url:t,data:n={},success:i=null,fail:s=null,header:r={}}=e;let a=function(e){let t="";for(let n in e)t+=`${n}=${e[n]}&`;return t.slice(0,t.length-1)}(n);var o=new XMLHttpRequest;o.open("GET",t+"?"+decodeURIComponent(a),!0),o.onreadystatechange=function(){let e=null;if(4==o.readyState&&200==o.status||304==o.status){try{e="string"==typeof o.responseText?JSON.parse(o.responseText):o.responseText}catch(t){e=o.responseText}i&&i.call(this,e)}else o.status&&200!=o.status&&s&&s.call(this,e)},o.send()}static requestPost(e){const{url:t,data:n={},success:i=null,fail:s=null,header:r={},ext:a={}}=e;var o=new XMLHttpRequest;o.open("POST",t,!0),a.notX8||o.setRequestHeader("Content-Type","application/json;charset=UTF-8");for(const e in r)o.setRequestHeader(e,r[e]);o.onreadystatechange=function(){let e=null;if(4==o.readyState&&200==o.status||304==o.status){try{e="string"==typeof o.responseText?JSON.parse(o.responseText):o.responseText}catch(t){e=o.responseText}i&&i.call(this,e)}else o.status&&200!=o.status&&s&&s.call(this,e)},o.send(JSON.stringify(n))}static create(e){const{url:t,type:n="get",data:i={},header:s={},ext:r={}}=e;return new Promise(((e,a)=>{switch(null==n?void 0:n.toLowerCase()){case"get":this.requestGet({url:t,data:i,header:s,ext:r,success:t=>{e(t)},fail:e=>{a(e)}});break;case"post":this.requestPost({url:t,data:i,header:s,ext:r,success:t=>{e(t)},fail:e=>{a(e)}})}}))}}class c{constructor(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashStr(e,t=!1){return this.onePassHasher.start().appendStr(e).end(t)}static hashAsciiStr(e,t=!1){return this.onePassHasher.start().appendAsciiStr(e).end(t)}static _hex(e){const t=c.hexChars,n=c.hexOut;let i,s,r,a;for(a=0;a<4;a+=1)for(s=8*a,i=e[a],r=0;r<8;r+=2)n[s+1+r]=t.charAt(15&i),i>>>=4,n[s+0+r]=t.charAt(15&i),i>>>=4;return n.join("")}static _md5cycle(e,t){let n=e[0],i=e[1],s=e[2],r=e[3];n+=(i&s|~i&r)+t[0]-680876936|0,n=(n<<7|n>>>25)+i|0,r+=(n&i|~n&s)+t[1]-389564586|0,r=(r<<12|r>>>20)+n|0,s+=(r&n|~r&i)+t[2]+606105819|0,s=(s<<17|s>>>15)+r|0,i+=(s&r|~s&n)+t[3]-1044525330|0,i=(i<<22|i>>>10)+s|0,n+=(i&s|~i&r)+t[4]-176418897|0,n=(n<<7|n>>>25)+i|0,r+=(n&i|~n&s)+t[5]+1200080426|0,r=(r<<12|r>>>20)+n|0,s+=(r&n|~r&i)+t[6]-1473231341|0,s=(s<<17|s>>>15)+r|0,i+=(s&r|~s&n)+t[7]-45705983|0,i=(i<<22|i>>>10)+s|0,n+=(i&s|~i&r)+t[8]+1770035416|0,n=(n<<7|n>>>25)+i|0,r+=(n&i|~n&s)+t[9]-1958414417|0,r=(r<<12|r>>>20)+n|0,s+=(r&n|~r&i)+t[10]-42063|0,s=(s<<17|s>>>15)+r|0,i+=(s&r|~s&n)+t[11]-1990404162|0,i=(i<<22|i>>>10)+s|0,n+=(i&s|~i&r)+t[12]+1804603682|0,n=(n<<7|n>>>25)+i|0,r+=(n&i|~n&s)+t[13]-40341101|0,r=(r<<12|r>>>20)+n|0,s+=(r&n|~r&i)+t[14]-1502002290|0,s=(s<<17|s>>>15)+r|0,i+=(s&r|~s&n)+t[15]+1236535329|0,i=(i<<22|i>>>10)+s|0,n+=(i&r|s&~r)+t[1]-165796510|0,n=(n<<5|n>>>27)+i|0,r+=(n&s|i&~s)+t[6]-1069501632|0,r=(r<<9|r>>>23)+n|0,s+=(r&i|n&~i)+t[11]+643717713|0,s=(s<<14|s>>>18)+r|0,i+=(s&n|r&~n)+t[0]-373897302|0,i=(i<<20|i>>>12)+s|0,n+=(i&r|s&~r)+t[5]-701558691|0,n=(n<<5|n>>>27)+i|0,r+=(n&s|i&~s)+t[10]+38016083|0,r=(r<<9|r>>>23)+n|0,s+=(r&i|n&~i)+t[15]-660478335|0,s=(s<<14|s>>>18)+r|0,i+=(s&n|r&~n)+t[4]-405537848|0,i=(i<<20|i>>>12)+s|0,n+=(i&r|s&~r)+t[9]+568446438|0,n=(n<<5|n>>>27)+i|0,r+=(n&s|i&~s)+t[14]-1019803690|0,r=(r<<9|r>>>23)+n|0,s+=(r&i|n&~i)+t[3]-187363961|0,s=(s<<14|s>>>18)+r|0,i+=(s&n|r&~n)+t[8]+1163531501|0,i=(i<<20|i>>>12)+s|0,n+=(i&r|s&~r)+t[13]-1444681467|0,n=(n<<5|n>>>27)+i|0,r+=(n&s|i&~s)+t[2]-51403784|0,r=(r<<9|r>>>23)+n|0,s+=(r&i|n&~i)+t[7]+1735328473|0,s=(s<<14|s>>>18)+r|0,i+=(s&n|r&~n)+t[12]-1926607734|0,i=(i<<20|i>>>12)+s|0,n+=(i^s^r)+t[5]-378558|0,n=(n<<4|n>>>28)+i|0,r+=(n^i^s)+t[8]-2022574463|0,r=(r<<11|r>>>21)+n|0,s+=(r^n^i)+t[11]+1839030562|0,s=(s<<16|s>>>16)+r|0,i+=(s^r^n)+t[14]-35309556|0,i=(i<<23|i>>>9)+s|0,n+=(i^s^r)+t[1]-1530992060|0,n=(n<<4|n>>>28)+i|0,r+=(n^i^s)+t[4]+1272893353|0,r=(r<<11|r>>>21)+n|0,s+=(r^n^i)+t[7]-155497632|0,s=(s<<16|s>>>16)+r|0,i+=(s^r^n)+t[10]-1094730640|0,i=(i<<23|i>>>9)+s|0,n+=(i^s^r)+t[13]+681279174|0,n=(n<<4|n>>>28)+i|0,r+=(n^i^s)+t[0]-358537222|0,r=(r<<11|r>>>21)+n|0,s+=(r^n^i)+t[3]-722521979|0,s=(s<<16|s>>>16)+r|0,i+=(s^r^n)+t[6]+76029189|0,i=(i<<23|i>>>9)+s|0,n+=(i^s^r)+t[9]-640364487|0,n=(n<<4|n>>>28)+i|0,r+=(n^i^s)+t[12]-421815835|0,r=(r<<11|r>>>21)+n|0,s+=(r^n^i)+t[15]+530742520|0,s=(s<<16|s>>>16)+r|0,i+=(s^r^n)+t[2]-995338651|0,i=(i<<23|i>>>9)+s|0,n+=(s^(i|~r))+t[0]-198630844|0,n=(n<<6|n>>>26)+i|0,r+=(i^(n|~s))+t[7]+1126891415|0,r=(r<<10|r>>>22)+n|0,s+=(n^(r|~i))+t[14]-1416354905|0,s=(s<<15|s>>>17)+r|0,i+=(r^(s|~n))+t[5]-57434055|0,i=(i<<21|i>>>11)+s|0,n+=(s^(i|~r))+t[12]+1700485571|0,n=(n<<6|n>>>26)+i|0,r+=(i^(n|~s))+t[3]-1894986606|0,r=(r<<10|r>>>22)+n|0,s+=(n^(r|~i))+t[10]-1051523|0,s=(s<<15|s>>>17)+r|0,i+=(r^(s|~n))+t[1]-2054922799|0,i=(i<<21|i>>>11)+s|0,n+=(s^(i|~r))+t[8]+1873313359|0,n=(n<<6|n>>>26)+i|0,r+=(i^(n|~s))+t[15]-30611744|0,r=(r<<10|r>>>22)+n|0,s+=(n^(r|~i))+t[6]-1560198380|0,s=(s<<15|s>>>17)+r|0,i+=(r^(s|~n))+t[13]+1309151649|0,i=(i<<21|i>>>11)+s|0,n+=(s^(i|~r))+t[4]-145523070|0,n=(n<<6|n>>>26)+i|0,r+=(i^(n|~s))+t[11]-1120210379|0,r=(r<<10|r>>>22)+n|0,s+=(n^(r|~i))+t[2]+718787259|0,s=(s<<15|s>>>17)+r|0,i+=(r^(s|~n))+t[9]-343485551|0,i=(i<<21|i>>>11)+s|0,e[0]=n+e[0]|0,e[1]=i+e[1]|0,e[2]=s+e[2]|0,e[3]=r+e[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(c.stateIdentity),this}appendStr(e){const t=this._buffer8,n=this._buffer32;let i,s,r=this._bufferLength;for(s=0;s<e.length;s+=1){if(i=e.charCodeAt(s),i<128)t[r++]=i;else if(i<2048)t[r++]=192+(i>>>6),t[r++]=63&i|128;else if(i<55296||i>56319)t[r++]=224+(i>>>12),t[r++]=i>>>6&63|128,t[r++]=63&i|128;else{if(i=1024*(i-55296)+(e.charCodeAt(++s)-56320)+65536,i>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");t[r++]=240+(i>>>18),t[r++]=i>>>12&63|128,t[r++]=i>>>6&63|128,t[r++]=63&i|128}r>=64&&(this._dataLength+=64,c._md5cycle(this._state,n),r-=64,n[0]=n[16])}return this._bufferLength=r,this}appendAsciiStr(e){const t=this._buffer8,n=this._buffer32;let i,s=this._bufferLength,r=0;for(;;){for(i=Math.min(e.length-r,64-s);i--;)t[s++]=e.charCodeAt(r++);if(s<64)break;this._dataLength+=64,c._md5cycle(this._state,n),s=0}return this._bufferLength=s,this}appendByteArray(e){const t=this._buffer8,n=this._buffer32;let i,s=this._bufferLength,r=0;for(;;){for(i=Math.min(e.length-r,64-s);i--;)t[s++]=e[r++];if(s<64)break;this._dataLength+=64,c._md5cycle(this._state,n),s=0}return this._bufferLength=s,this}getState(){const e=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[e[0],e[1],e[2],e[3]]}}setState(e){const t=e.buffer,n=e.state,i=this._state;let s;for(this._dataLength=e.length,this._bufferLength=e.buflen,i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],s=0;s<t.length;s+=1)this._buffer8[s]=t.charCodeAt(s)}end(e=!1){const t=this._bufferLength,n=this._buffer8,i=this._buffer32,s=1+(t>>2);this._dataLength+=t;const r=8*this._dataLength;if(n[t]=128,n[t+1]=n[t+2]=n[t+3]=0,i.set(c.buffer32Identity.subarray(s),s),t>55&&(c._md5cycle(this._state,i),i.set(c.buffer32Identity)),r<=4294967295)i[14]=r;else{const e=r.toString(16).match(/(.*?)(.{0,8})$/);if(null===e)return;const t=parseInt(e[2],16),n=parseInt(e[1],16)||0;i[14]=t,i[15]=n}return c._md5cycle(this._state,i),e?this._state:c._hex(this._state)}}if(c.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),c.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),c.hexChars="0123456789abcdef",c.hexOut=[],c.onePassHasher=new c,"5d41402abc4b2a76b9719d911017c592"!==c.hashStr("hello"))throw new Error("Md5 self test failed.");function l(){return window.localStorage.getItem("lvdid")||function(){let e=navigator.userAgent.toLocaleLowerCase(),t="cd_"+c.hashStr(e+((new Date).getTime()+Math.floor(1e4*Math.random())/1e4));return window.localStorage.setItem("lvdid",t),t}()}const u={log_id:{origin:"handler",handlerId:"getLogId"},event_time:{origin:"handler",handlerId:"getEventTime"},game_id:{origin:"handler",handlerId:"getGameId"},pub_id:{origin:"handler",handlerId:"getPubId"},tunnel_id:{origin:"handler",handlerId:"getTunnelId"},platform:{origin:"handler",handlerId:"getPlatform"},app_version:{origin:"sdk",default:"",paramId:!1},device_id:{origin:"handler",handlerId:"getDeviced"},cpsdk_version:{origin:"sdk",paramId:"cpsdk_version"},cpsdk_account_id:{origin:"sdk",paramId:"cpsdk_account_id"},device_os:{origin:"handler",handlerId:"getDeviceOs"},device_version:{origin:"handler",handlerId:"getDeviceVersion"},device_nm:{origin:"sdk",default:"",paramId:!1},device_score:{origin:"sdk",default:"",paramId:!1},device_name:{origin:"sdk",default:"",paramId:!1},device_screen:{origin:"handler",handlerId:"getDeviceScreen"},cpu_count:{origin:"sdk",default:"",paramId:!1},cpu_freq:{origin:"sdk",default:"",paramId:!1},cpu_model:{origin:"sdk",default:"",paramId:!1},cpu_mem:{origin:"sdk",default:"",paramId:!1},total_space:{origin:"sdk",default:"",paramId:!1},free_space:{origin:"sdk",default:"",paramId:!1},imei:{origin:"sdk",default:"",paramId:!1},oaid:{origin:"sdk",default:"",paramId:!1},android_id:{origin:"sdk",default:"",paramId:!1},is_emu:{origin:"sdk",default:"",paramId:!1},languages:{origin:"handler",handlerId:"getLanguages"},user_ip:{origin:"sdk",default:"",paramId:!1},project_id:{origin:"handler",handlerId:"getProjectId"},subgame_id:{origin:"handler",handlerId:"getSubgameId"},channel_id:{origin:"handler",handlerId:"getChannelId"},ad_id:{origin:"sdk",default:"",paramId:!1},pubsdk_version:{origin:"sdk",paramId:"pubsdk_version"},pubsdk_account_id:{origin:"sdk",paramId:"pubsdk_account_id"},pubsdk_account_name:{origin:"sdk",paramId:"pubsdk_account_name"},is_first_active:{origin:"sdk",paramId:"is_first_active"},ad_details:{origin:"sdk",default:"",paramId:!1}};const p=n(685),h={getLogId:()=>c.hashStr(+new Date+(Math.ceil(9999*Math.random())+""))+Math.ceil(9999*Math.random()),getIp:()=>{return e=void 0,t=void 0,i=function*(){let e="";return yield d.create({url:"https://pv.sohu.com/cityjson?ie=utf-8",type:"GET"}).then((t=>{const n=t.indexOf("{"),i=t.indexOf("}");e=JSON.parse(t.slice(n,i+1)).cip})),e},new((n=void 0)||(n=Promise))((function(s,r){function a(e){try{d(i.next(e))}catch(e){r(e)}}function o(e){try{d(i.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}d((i=i.apply(e,t||[])).next())}));var e,t,n,i},getEventTime:()=>"+"+i(0-(new Date).getTimezoneOffset()/60,2)+"00 "+function(e,t="year-month-day hour:min:sec"){let n;n="object"!=typeof e?new Date(e):e;const s=n.getFullYear()+"",r=n.getMonth()+1,a=n.getDate(),o=n.getHours(),d=n.getMinutes(),c=n.getSeconds();return t.replace("year",s).replace("month",i(r,2)+"").replace("day",i(a,2)+"").replace("hour",i(o,2)+"").replace("min",i(d,2)+"").replace("sec",i(c,2)+"")}(new Date),getGameId:()=>"1",getPubId:()=>"1",getTunnelId:()=>"1",getPlatform:()=>"3",getDeviced:()=>l(),getDeviceOs:()=>{switch(s().split(" ")[0]){case"windows":return"3";case"ios":return"1";case"android":return"2";default:return"0"}},getDeviceVersion:()=>s().split(" ")[1],getDeviceScreen:()=>`${window.innerWidth}*${window.innerHeight}`,getLanguages:()=>navigator.languages||"zh",getProjectId:()=>a.getInstance().get("projectId"),getSubgameId:()=>a.getInstance().get("subgameId"),getChannelId:()=>a.getInstance().get("lvchannelid")};let g,m,_,f={},v={};function b(e,t){if("other"==e){let e={};return t.map((t=>{e[t]=k(t)})),e}{let n={},i=p[g+"glog"];n.version=i.version,n.event=g+"sdk_"+e,["log_id","event_time"].concat(i[e].split(",")).map((e=>{n[e]=k(e)})),Object.assign(v,t),Object.assign(n,t),I([n])}}function k(e){let t=u[e];switch(t.origin){case"handler":return function(e){if(!e)return"";try{return h[e.handlerId]()}catch(e){}}(t);case"sdk":return function(e){return e?e.paramId?f[e.paramId]:e.default:""}(t)}}function w(e){Object.assign(f,e)}function I(e){d.create({url:"//sdk-glog.iwgame.com/t1",data:e,type:"POST",ext:{notX8:!0}}).then((t=>{0!=t.code&&-1!=e.event.indexOf("heartbeat")&&function(e){let t=localStorage.getItem(g+"sdk_log")?JSON.parse(localStorage.getItem(g+"sdk_log")):[];localStorage.setItem(g+"sdk_log",JSON.stringify(t.concat(e))),_||(_=setTimeout((()=>{let e=localStorage.getItem(g+"sdk_log")?JSON.parse(localStorage.getItem(g+"sdk_log")):[];e.length>0&&I(e),_=null}),3e5))}(e),m||-1==e[0].event.indexOf("role_login")||(m=setInterval((()=>{b("heartbeat",v)}),3e5))}))}const S={code:200,msg:"成功"},y={code:9001,msg:"网络未知错误"},O={code:9003,msg:"CP WORK方法未实现"},x={code:60100,msg:"内部初始化失败"},L={code:60130,msg:"内部h5实现初始化失败"},P={code:60131,msg:"内部h5实现初始化加载发行资源失败"},D={code:60132,msg:"内部h5实现初始化加载发行SDK资源失败"},A={code:60133,msg:"内部h5实现初始化加载发行实现资源失败"},j={code:70131,msg:"h5work发行初始化失败"},T={code:70231,msg:"h5work发行登录失败"},E={code:70232,msg:"h5work登录失败"};function C(e,...t){return e.code==S.code?t.length>0&&o.commonS("[cp work]",...t):o.error(e.msg,"[cp work][code:]"+e.code,...t),Object.assign({},e)}let B=n(206).F,F=n(541).v;const N=n(147);class z{insideInit(e){o.commonS("h5work初始化开始。");let t=this.loadPublisherInfo();g="cp",t.then((()=>{w({cpsdk_version:N.version}),b("active",{is_first_active:r()}),e({cpSpace:this.getSpaceFunction()}),o.commonS("h5work初始化完成。")})).catch((e=>{C(P,e)}))}loadPublisherInfo(){return o.commonS("发行资源加载开始。"),new Promise(((e,t)=>{Promise.all([this.loadCpSDKFile(B),this.loadPublisherSDKFile(F.getSdkSign,F.sdkType)]).then((t=>{o.commonS("发行资源加载结束。"),this.publisherSDk=new t[0],e(!0)})).catch((e=>{t(e)}))}))}loadCpSDKFile(e){return o.commonS("发行实现加载开始"),new Promise(((t,n)=>{o.commonS("发行实现加载完成"),e?t(e):(C(A),n({e:new Error("发行实现缺失"),pubCOde:"lvan"}))}))}loadPublisherSDKFile(e,t){return o.commonS("发行渠道sdk加载开始。"),new Promise(((n,i)=>{if("script"==t){o.commonS("发行渠道sdk script模式。");const t=document.createElement("script");window.sdkLoadCallback=()=>{o.commonS("发行渠道sdk加载完成。"),n(!0)},window.sdkLoadErrorBack=e=>{C(D,e),i(e)},t.textContent=e;let s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}else o.commonS("发行渠道sdk src模式。"),function(e,t,n,s){if(document.body){let n=document.createElement("script");n.src=e,n.onload=t,n.onerror=e=>{C(D,e),i(e)},s&&(n.type=s),document.body.append(n)}else document.write(`<script src="${e}" onload="${t()}"><\/script>`)}(e,(()=>{n(!0)}),0,t)}))}init(e){o.commonS("h5work 初始化开始");const{callback:t}=e;this.publisherSDk.init?this.noticePushlierInit(e):(o.commonS("h5work 初始化完成"),t(Object.assign({},C(S))))}noticePushlierInit(e){o.commonS("h5work发行初始化开始");const{callback:t,game_version:n}=e;this.publisherSDk.init({game_version:n}).then((e=>{let n=Object.assign({},C(S,"h5work发行初始化完成"));e.data&&(n.data=e.data),t(n)})).catch((e=>{t(Object.assign({},C(j,e)))}))}login(e){o.commonS("h5work发行登录开始");const{callback:t}=e;this.publisherSDk.login().then((e=>{o.commonS("h5work发行登录完成"),200==e.code&&this.insideLogin(e.data,t)})).catch((e=>{t(Object.assign({},C(T)))}))}insideLogin(e,t){o.commonS("h5work内部登录开始"),d.create({url:"//cpsdk-demo-dev.iwgame.com/sdk/client/login",data:{zoneId:"1",tunnelId:"1",pubId:"1",gameId:"1",pubTokenInfo:JSON.stringify(Object.assign({},e)),deviceEnv:this.getDeviceEnv()},type:"POST"}).then((e=>{0==e.code?(w({cpsdk_account_id:e.data.cpsdkAccountId}),t(Object.assign(Object.assign({},C(S,"h5work内部登录成功")),{data:{cpsdkToken:e.data.cpsdkToken,tunnelId:e.data.tunnelId,zoneId:e.data.zoneId}}))):t(Object.assign({},C(E,e)))})).catch((e=>{t(Object.assign({},C(y,e)))}))}pay(e){o.commonS("h5work发行支付拉起开始"),this.publisherSDk.pay(e),b("pay_order_client",e)}getDeviceEnvOutSide(e){o.commonS("h5work环境信息获取开始");const{callback:t}=e;t&&t(this.getDeviceEnv())}getDeviceEnv(){return window.btoa(JSON.stringify({env:Object.assign({os:navigator.platform,deviceId:l(),serial:"",imei:"",androidId:"",oaid:"",idfa:"",ip:"",brand:"",mobileModel:""},b("other",["device_id","platform","app_version","cpsdk_version","pubsdk_version"])),pub:Object.assign({},b("other",["channel_id"]))}))}logout(){o.commonS("h5work发行登出开始"),this.publisherSDk.logout()}switchAccount(e){o.commonS("h5work发行切换账号开始");const{callback:t}=e;this.publisherSDk.switchAccount?this.publisherSDk.switchAccount().then((e=>{200==e.code&&this.insideLogin(e.data,t)})):this.publisherSDk.logout()}activeShare(){o.warn(function(e,...t){o.warn(e.msg,"[cp work][code:]"+e.code,...t)}(O))}onEventLog({eventCode:e,eventData:t}){o.commonS("数据上报开始",e,t),b(e,t),this.publisherSDk.report&&this.publisherSDk.report(e,t)}getSpaceFunction(){return{init:this.init.bind(this),login:this.login.bind(this),pay:this.pay.bind(this),logout:this.logout.bind(this),switchAccount:this.switchAccount.bind(this),getDeviceEnv:this.getDeviceEnvOutSide.bind(this),onEventLog:this.onEventLog.bind(this)}}}class M{static getInstance(){return M.instance||(M.instance=new M),this.instance}init(){return new Promise(((e,t)=>{(new z).insideInit(e)}))}}let U=new class{constructor(){this.insideInitState=!1,this.externalInitState=!1,o.timeStart("sdk_init_inside"),o.commonS("sdk内部初始化开始。"),this.init()}init(){let e;e=this.initH5(),e.then((({cpSpace:e})=>{this.judgeExternalInitState(e),o.commonS("sdk内部初始化结束。"),o.timeEnd("sdk_init_inside")})).catch((()=>{C(x)}))}initIos(){}initAndroid(){}initH5(){return o.commonS("h5初始化开始。"),new Promise((e=>{M.getInstance().init().then((t=>{o.commonS("h5初始化成功。"),e(t)})).catch((()=>{C(L)}))}))}externalInit(e){const{cpSpace:t}=e;this.insideInitState?(o.commonS("game-cp 内部初始化已完成"),Object.assign(t,this.insideInitResult.cpSpace),this.insideInitResult.cpSpace.init(e)):(o.commonS("game-cp 内部初始化未完成"),this.externalInitState=!0,this.externalInitParams=e,this.cpSpace=t)}judgeExternalInitState(e){this.externalInitState?(o.commonS("cp-game 外部初始化已执行"),Object.assign(this.cpSpace,e),e.init(this.externalInitParams)):(o.commonS("cp-game 等待外部初始化开始"),this.insideInitState=!0,this.insideInitResult={cpSpace:e})}};window.CPLASDK=class{static init(e){const{callback:t,game_version:n}=e;o.commonS("游戏调用sdk初始化开始。"),U.externalInit({cpSpace:this,callback:t,game_version:n})}}})()})();
//# sourceMappingURL=index.js.map