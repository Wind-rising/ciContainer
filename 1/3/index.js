(()=>{"use strict";var t;function i(){var t=performance.timing?performance.timing.navigationStart:performance.timeOrigin;return 1e3*(performance.now()+t)}!function(t){t.dev="dev",t.uat="uat",t.master="master"}(t||(t={}));class e{constructor(){this.urlParams=this.analysis()}static getInstance(){return this.instance}analysis(){return(t=>{let i={};return t.split("&").map((t=>{let e=t.split("=");i[e[0]]=e[1]})),i})(location.search.slice(1,location.search.length))}get(t){return this.urlParams[t]}getAll(){return this.urlParams}getIsAndroid(){return Boolean(e.getInstance().get("android"))}getIsIos(){return Boolean(e.getInstance().get("ios"))}getIsApp(){return Boolean(e.getInstance().get("isApp"))}getPubisherId(){return e.getInstance().get("pubId")}getPubisherCode(){return e.getInstance().get("pubCode")}getGameId(){return e.getInstance().get("gameId")}getZoneId(){return e.getInstance().get("zoneId")}getTunnelId(){return e.getInstance().get("tunnelId")}}e.instance=new e;class n{static common(...i){"dev"!=t.master&&console.log("[cpsdk][debugger log]:",...i)}static commonS(...i){("dev"!=t.master||"debug"==e.getInstance().get("logDebug"))&&console.log("[cpsdk][info]:",...i)}static error(...i){"dev"!=t.master&&console.error("[cpsdk][error]:",...i)}static warn(...i){"dev"!=t.master&&console.warn("[cpsdk][warnning]:",...i)}static timeStart(e){if("dev"!=t.master)return this.logTimeState.hasOwnProperty(e)&&this.error(`logName ${e} is exist`),this.logTimeState[e]=i(),console.log(`[cpsdk][timer]:start ${e}`),e}static timeEnd(e){if("dev"!=t.master){this.logTimeState.hasOwnProperty(e)||this.error(`logName ${e} is not exist`);const t=i()-this.logTimeState[e];return console.log(`[cpsdk][timer]:end ${e} --${t}μs`),t}}}n.logTimeState={};const s={code:200,msg:"成功"},o={code:60100,msg:"内部初始化失败"},a={code:60120,msg:"内部android实现初始化失败"},c={code:70121,msg:"android壳初始化失败"},l={code:70122,msg:"android壳初始化数据解析失败"},r={code:70221,msg:"android壳登录失败"},d={code:70221,msg:"android壳登录数据解析失败"};function g(t,...i){return t.code==s.code?i.length>0&&n.commonS("[cp work]",...i):n.error(t.msg,"[cp work][code:]"+t.code,...i),Object.assign({},t)}var m;!function(t){t.INIT="init",t.LOGIN="login",t.SWITCH_LOGIN="switchLogin",t.LOGOUT="logout",t.SUBMIT_GAME_DATA="submitGameData",t.GET_DEVICE_INFO="getDeviceInfo",t.PAY="pay",t.OPEN_ACCOUNT_CENTER="accountCenter",t.COPY_TEXT="copyText",t.BIND_IDCARD="bindIDCard",t.BIND_MOBILE="bindMobile",t.BIND_ACCOUNT="bindAccount",t.SHARE_SHOW_BLOCK="shareShowBlock",t.SWITCH_CONFIG="getSwitchConfig",t.LOGOUT_LISTENER="logoutListener"}(m||(m={}));class h{constructor(){this.store={},this.initCall=null,this.loginCall=null,this.getDeviceCall=null,window.callH5={initBack:this.initBack.bind(this),loginBack:this.loginBack.bind(this),getDeviceEnvBack:this.getDeviceEnvBack.bind(this),switchAccountBack:this.switchAccountBack.bind(this),logoutBack:this.logoutBack.bind(this)}}callApp(t,...i){var e="window.lashell."+t+"(";i&&i.map((t=>{e+="'",e+=t,e+="',"})),e+=")",n.commonS("[call app->]",e),new Function("return "+e)()}insideInit(t,i){t({cpSpace:this.getSpaceFunction()})}init(t){n.commonS("android壳初始化开始");const{callback:i}=t;this.initCall=i,this.callApp(m.INIT,JSON.stringify({callName:"callH5.initBack"}))}initBack(t){n.commonS("android壳初始化完成",t);try{if(null==(t=JSON.parse(t))?void 0:t.isSuc){const{zoneid:i,tunnelid:e,gameid:o,pubid:a}=t;this.store.zoneId=i,this.store.tunnelId=e,this.store.gameId=o,this.store.pubId=a,n.commonS("android壳初始化成功"),this.initCall&&this.initCall(Object.assign({},g(s))),this.initCall=null}else g(c),this.callApp(m.INIT,JSON.stringify({callName:"callH5.initBack"}))}catch(t){this.initCall&&this.initCall(Object.assign({},g(l)))}}login(t){n.commonS("android壳登录开始");const{callback:i}=t;this.loginCall=i,this.callApp(m.LOGIN,JSON.stringify({callName:"callH5.loginBack"}))}loginBack(t){n.commonS("android壳登录完成",t);try{(null==(t=JSON.parse(t))?void 0:t.isSuc)?(n.commonS("android壳登录成功"),this.loginCall&&this.loginCall(Object.assign(Object.assign({},g(s)),{data:{cpsdkToken:t.token,tunnelId:this.store.tunnelId-0,zoneId:this.store.zoneId-0,gameId:this.store.gameId-0,pubId:this.store.pubId-0}}))):this.loginCall&&this.loginCall(Object.assign({},g(r)))}catch(t){g(d),this.loginCall&&this.loginCall(Object.assign({},g(d)))}}onEventLog({eventCode:t,eventData:i}){n.commonS("android壳数据上报开始",t,i),this.callApp(m.SUBMIT_GAME_DATA,t,JSON.stringify(i))}pay(t){n.commonS("android壳支付开始",t),this.callApp(m.PAY,JSON.stringify({data:{productId:t.product_id,productName:t.product_name,productDesc:t.product_desc||"",price:t.order_amount,productPrice:t.order_amount,orderID:t.cpsdk_order_id,serverID:t.server_id,serverName:t.server_name,roleID:t.role_id,roleName:t.role_name,extension:t.extension,buyNum:t.product_num,roleLevel:t.role_level,vip:t.role_vip_level}}))}getDeviceEnv(t){n.commonS("android壳获取设备信息开始");const{callback:i}=t;this.getDeviceCall=i,this.callApp(m.GET_DEVICE_INFO,JSON.stringify({callName:"callH5.getDeviceEnvBack"}))}getDeviceEnvBack(t){n.commonS("andorid壳获取设备信息完成",t),this.getDeviceCall&&this.getDeviceCall(t)}logout(){n.commonS("android壳登出开始"),this.callApp(m.LOGOUT,JSON.stringify({callName:"callH5.logoutBack"}))}switchAccount(t){n.commonS("android壳切换账号开始"),this.callApp(m.LOGOUT,JSON.stringify({callName:"callH5.switchAccountBack"}))}switchAccountBack(t){n.commonS("android壳切换账号完成，h5实现刷新"),window.location.reload()}logoutBack(t){n.commonS("android壳登出完成，h5实现刷新"),window.location.reload()}getSpaceFunction(){return{init:this.init.bind(this),login:this.login.bind(this),pay:this.pay.bind(this),logout:this.logout.bind(this),switchAccount:this.switchAccount.bind(this),getDeviceEnv:this.getDeviceEnv.bind(this),onEventLog:this.onEventLog.bind(this)}}}class u{static getInstance(){return u.instance||(u.instance=new u),this.instance}init(){return new Promise(((t,i)=>{(new h).insideInit(t,i)}))}}let p=new class{constructor(){this.insideInitState=!1,this.externalInitState=!1,n.timeStart("sdk_init_inside"),n.commonS("sdk内部初始化开始。"),this.init()}init(){let t;t=this.initAndroid(),t.then((({cpSpace:t})=>{this.judgeExternalInitState(t),n.commonS("sdk内部初始化结束。"),n.timeEnd("sdk_init_inside")})).catch((()=>{g(o)}))}initIos(){}initAndroid(){return n.commonS("android初始化开始。"),new Promise((t=>{u.getInstance().init().then((i=>{n.commonS("android初始化成功。"),t(i)})).catch((()=>{g(a)}))}))}initH5(){}externalInit(t){const{cpSpace:i}=t;this.insideInitState?(n.commonS("game-cp 内部初始化已完成"),Object.assign(i,this.insideInitResult.cpSpace),this.insideInitResult.cpSpace.init(t)):(n.commonS("game-cp 内部初始化未完成"),this.externalInitState=!0,this.externalInitParams=t,this.cpSpace=i)}judgeExternalInitState(t){this.externalInitState?(n.commonS("cp-game 外部初始化已执行"),Object.assign(this.cpSpace,t),t.init(this.externalInitParams)):(n.commonS("cp-game 等待外部初始化开始"),this.insideInitState=!0,this.insideInitResult={cpSpace:t})}};window.CPLASDK=class{static init(t){const{callback:i,game_version:e}=t;n.commonS("游戏调用sdk初始化开始。"),p.externalInit({cpSpace:this,callback:i,game_version:e})}}})();
//# sourceMappingURL=index.js.map